//
// Created by matte on 23/02/2024.
//
#include "gtest/gtest.h"
#include "../ShoppingList.h"

TEST(ShoppingListTest, Constructor) {                                    // provo a creare una lista
    std::cout << "Test ShoppingList Constructor" << std::endl;
    ShoppingList shoppingList("Test List");
    EXPECT_EQ(shoppingList.getListName(), "Test List");               // verifico il nome della lista
    std::cout << "Test ShoppingList Constructor Done" << std::endl << std::endl;

}

TEST(ShoppingListTest, searchItem){
    std::cout << "Test ShoppingList searchItem" << std::endl;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    Item item("Uova", "Proteine", 8);
    Item item2("Pane", "Carboidrati", 4);
    ShoppingList shoppingList("Test List");
    shoppingList.addToList(item2);
    auto itr = shoppingList.searchItem("Pane");                         // provo a cercare un elemento presente nella lista tramite la sua chiave
    EXPECT_EQ(itr->second, item2);                                      // controllo che l'elemento cercato sia quello corretto
    std::cout << "Test ShoppingList searchItem Done" << std::endl << std::endl;
}

TEST(ShoppingListTest, AddToList) {
    std::cout << "Test ShoppingList AddItem" << std::endl;
    Item item("Uova", "Proteine", 8);
    Item item2("Pane", "Carboidrati", 4);

    ShoppingList shoppingList("Test List");

    EXPECT_EQ(shoppingList.getList().size(), 0);                         // controllo che la lista sia vuota

    shoppingList.addToList(item);
    shoppingList.addToList(item2);                                       // aggiungo elementi non presenti e controllo che
    EXPECT_EQ(shoppingList.getList().size(), 2);                         // vengano inseriti come nuovi elementi

    shoppingList.addToList(item);                                        // aggiungo elemento già presente, dunque incremento la quantità
    EXPECT_EQ(shoppingList.getList().size(), 2);                         // degli elementi già presenti, ma non inserisco nuovi elementi

    auto itr = shoppingList.searchItem("Uova");
    EXPECT_EQ(itr->second.getQuantity(), 16);                            //controllo che la quantità sia stata incrementata

    shoppingList.addToList(item2);                                       // aggiungo elemento già presente, dunque incremento la quantità
    auto itr2 = shoppingList.searchItem("Pane");
    EXPECT_EQ(itr2->second.getQuantity(), 8);                            //controllo che la quantità sia stata incrementata

    std::cout << "Test ShoppingList AddItem Done" << std::endl<<std::endl;
}

TEST(ShoppingListTest, removeFromList) {
    std::cout << "Test ShoppingList RemoveItem" << std::endl;
    Item item("Uova", "Proteine", 8);
    Item item2("Pane", "Carboidrati", 4);
    Item item3("Uova", "Proteine", 4);
    ShoppingList shoppingList(" Generic List");

    shoppingList.addToList(item);
    shoppingList.addToList(item2);
    EXPECT_EQ(shoppingList.getList().size(), 2);                        //controllo che la lista sia stata riempita

    shoppingList.removeFromList(item);                                  //rimuovo un elemento presente nella lista
    EXPECT_EQ(shoppingList.getList().size(), 1);                        // verifico che la lista sia stata ridotta di dimensione

    std::cout <<"Trying to remove: "<< item3.getDescription() << ": ";//rimuovo un elemento non presente nella lista, la quale non cambierà dimensione
    shoppingList.removeFromList(item3);
    EXPECT_EQ(shoppingList.getList().size(), 1);                        //rimuovo un elemento presente nella lista
                                                                        // un elemento non presente nella lista
    shoppingList.removeFromList(item2);
    EXPECT_EQ(shoppingList.getList().size(), 0);                        //rimuovo l'ultimo elemento e controllo che la lista sia vuota

    std::cout << "Test ShoppingList RemoveItem Done" << std::endl << std::endl;
}

TEST(ShoppingListTest, decreaseQuantity) {
    std::cout << "Test ShoppingList decreaseQuantity" << std::endl;
    Item item("Uova", "Proteine", 8);
    Item item2("Pane", "Carboidrati", 4);
    Item item3("Uova", "Proteine", 4);
    Item item4("Pizza", "Carboidrati", 4);
    Item item5("Pizza", "Carboidrati", 10);
    Item item6("Carote", "Verdure", 5);
    ShoppingList shoppingList("Generic List");

    shoppingList.addToList(item);
    shoppingList.addToList(item2);
    EXPECT_EQ(shoppingList.getList().size(), 2);                        //controllo che la lista sia stata riempita

    shoppingList.decreaseQty(item3);
    EXPECT_EQ(shoppingList.searchItem("Uova")->second.getQuantity(), 4);//decremento la quantità di un elemento
    EXPECT_EQ(shoppingList.getList().size(), 2);                        //controllo che la lista mantenga la stessa dimensione

    shoppingList.decreaseQty(item3);                                    //decremento la quantità di un elemento fino a 0
    EXPECT_EQ(shoppingList.getList().size(), 1);                        //e controllo che la lista sia stata ridotta di dimensione

    shoppingList.addToList(item4);
    shoppingList.decreaseQty(item5);                                    //decremento la quantità di un elemento più della quantità presente
    EXPECT_EQ(shoppingList.getList().size(), 2);                        //e controllo che la lista non sia stata ridotta di dimensione

    std::cout << "Trying to decrease : " << item4.getDescription() << "quantity ";
    shoppingList.decreaseQty(item6);                                    //decremento la quantità di un elemento non presente nella lista
    std::cout << "Test ShoppingList decreaseQuantity Done" << std::endl << std::endl;

}

TEST(ShoppingListTest, buyItem) {
    std::cout << "Test ShoppingList buyItem" << std::endl;
    Item item("Uova", "Proteine", 8);
    Item item2("Pane", "Carboidrati", 4);
    Item item3("Uova", "Proteine", 4);
    Item item4("Pane", "Carboidrati", 5);
    Item item5("Pizza", "Carboidrati", 4);
    ShoppingList shoppingList("Generic List");

    shoppingList.addToList(item);
    shoppingList.addToList(item2);
    shoppingList.buyItem(item3);
    EXPECT_EQ(shoppingList.searchItem("Uova")->second.getQuantity(), 4);//decremento la quantità di un elemento
    EXPECT_FALSE(shoppingList.searchItem("Uova")->second.isBought());   //controllo che l'elemento sia ancora da finire di comprare

    shoppingList.buyItem(item3);
    EXPECT_TRUE(shoppingList.searchItem("Uova")->second.isBought());    //controllo che l'elemento venga segnato come comprato

    std::cout << "Trying to buy: " << item4.getDescription() << ": ";
    shoppingList.buyItem(item4);
    EXPECT_EQ(shoppingList.getList().size(), 2);

    std::cout << "Trying to buy: " << item5.getDescription() << ": ";
    shoppingList.buyItem(item5);

    std::cout << "Test ShoppingList buyItem Done" << std::endl;
}
